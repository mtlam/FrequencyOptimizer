Timer unit: 1e-06 s

Total time: 0.003997 s
File: /users/tcohen/python/projects/FrequencyOptimizer/frequencyoptimizer.py
Function: DM_misestimation at line 540

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   540                                               @profile
   541                                               def DM_misestimation(self,nus,errs,covmat=False):#,fullDMnu=True):
   542                                                   '''
   543                                                   Return sum of DM mis-estimation errors
   544                                                   '''
   545         1          3.0      3.0      0.1          N = len(nus)
   546         1         23.0     23.0      0.6          X = np.matrix(np.ones((N,2))) #design matrix
   547       101         54.0      0.5      1.4          for i,nu in enumerate(nus):
   548       100         80.0      0.8      2.0              X[i,1] = K/nu**2
   549                                           
   550                                                   # Template-Fitting Errors
   551         1          1.0      1.0      0.0          if covmat is False:
   552                                                       V = np.matrix(np.diag(errs**2)) #weights matrix
   553                                                   else:
   554         1          1.0      1.0      0.0              V = errs
   555         1          5.0      5.0      0.1          XT = X.T
   556         1        821.0    821.0     20.5          VI = V.I
   557         1        121.0    121.0      3.0          P = np.dot(np.dot(XT,VI),X).I 
   558                                           
   559                                           
   560                                           
   561                                           
   562                                                   # for now, ignore covariances and simply return the t_inf error    
   563         1          6.0      6.0      0.2          template_fitting_var = P[0,0] 
   564                                           
   565                                                   ## Frequency-Dependent DM
   566                                                   #DM_nu_var = evalDMnuError(self.psrnoise.dnud,np.max(nus),np.min(nus))**2 / 25.0
   567         1       1934.0   1934.0     48.4          DM_nu_cov = self.build_DMnu_cov_matrix(nus)
   568         1        891.0    891.0     22.3          DM_nu_var = epoch_averaged_error(DM_nu_cov,var=True)
   569                                                   #print nus
   570                                                   # FOO
   571                                                   #print DM_nu_cov
   572                                                   #print DM_nu_var
   573         1          2.0      2.0      0.1          if DM_nu_var < 0.0:# or np.isnan(DM_nu_var): #no longer needed
   574                                                       DM_nu_var = 0 
   575                                           
   576                                           
   577                                                   
   578                                           
   579                                                   # PBF errors (scattering), included already in cov matrix?
   580                                                   # Scattering error, assume this is proportional to nu^-4.4? or 4?
   581         1         11.0     11.0      0.3          chromatic_components = self.psrnoise.tauvar * np.power(nus,-4.4)
   582         1         39.0     39.0      1.0          scattering_var = np.dot(np.dot(np.dot(P,XT),VI),chromatic_components)[0,0]**2
   583                                           
   584                                           
   585                                           
   586                                           
   587         1          3.0      3.0      0.1          retval = np.sqrt(template_fitting_var + DM_nu_var + scattering_var)
   588                                                   
   589         1          1.0      1.0      0.0          if self.vverbose:
   590                                                       print("DM misestimation noise: %0.3f us"%retval)
   591                                                       
   592                                                       print("   DM estimation error: %0.3f us"%np.sqrt(template_fitting_var))
   593                                                       print("   DM(nu) error: %0.3f us"%np.sqrt(DM_nu_var))
   594                                                       print("   Chromatic term error: %0.3f us"%np.sqrt(scattering_var))
   595                                           
   596                                           
   597         1          1.0      1.0      0.0          return retval

